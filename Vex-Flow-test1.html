<!doctype html>
<html lang="en-US" direction="ltr">
<head>
	<meta charset="utf-8" />
	<title>First rythms</title>
	<link rel="stylesheet" href="reset.css">
	<!-- <link rel="stylesheet" href="style.css"> -->
	<script src="jquery.js" ></script>
	<script src="vexflow/releases/vexflow-min.js"></script>
	<script src="raphael-min.js"></script>
	<script type="text/javascript">
			
		document.ready = pianoComposer.generateStave();
			var canvasTag = $('canvas')[0];
			var pianoComposer = new composerClass(canvasTag);

			var composerClass = function(canvas){

				this.canvas   = canvas;
				this.renderer = new Vex.Flow.Renderer(this.canvas,
					Vex.Flow.Renderer.Backends.CANVAS);

				this.ctx      = this.renderer.getContext();
				this.stave    = new Vex.Flow.Stave(10,0,500);

			}

			composerClass.prototype.generateStave = function() {
				this.stave.addClef("treble");
				this.stave.setContext(this.ctx).draw();
			};


			var notes = [];
			var notesPos = [];
			var gap = 0;
			var clickedNote;
			var octave,choosedNote,durationOfNote;
			function adNote (){
				ctx.clear();  // first clear otherwise previuse notes will remain
				stave.setContext(ctx).draw();
				 octave = $("#octaves").val();
				 choosedNote = $("#notes").val();
				 durationOfNote = $("#duration").val();
				console.log(octave,choosedNote,durationOfNote);
				notes.push(new Vex.Flow.StaveNote({ keys: [choosedNote+"/"+octave], duration: durationOfNote }));
				console.log(notes);
				Vex.Flow.Formatter.FormatAndDraw(ctx, stave, notes);
				
				for(i=0; i < notes.length ; i++) {
					notesPos[i] = notes[i].getAbsoluteX();
				}

				if(notes.length>1) {
					gap = notesPos[1]-notesPos[0];
				}

				
				console.log(notesPos[2]-notesPos[1]);
				console.log(notesPos[1]-notesPos[0]);
			}

			// Helper function to justify and draw a 4/4 voice
			

			$("#add_note").click(adNote);

			function highlightNote (position){
				ctx.fillStyle = "#ff0000";
				ctx.fillRect(position, 40, 2, 50);
				ctx.fillStyle = "#000";
			}

			canvas.addEventListener('click',function(e){
				var mouseCord = event.clientX;
				for(j = 0;j<notesPos.length;j++) {
					if(mouseCord<notesPos[j] && mouseCord> notesPos[j-1]) {
						if(mouseCord<=notesPos[j-1]+((notesPos[j]-notesPos[j-1])/2)) { 
							alert(j-1);
							clickedNote = j-1;
							highlightNote(notesPos[j-1]);
						}
						else {
							alert(j);
							clickedNote = j;
							highlightNote(notesPos[j]);
						}
					}
				}

			})
			$("#edit_note").click(editNote);
			function editNote (){
				ctx.clear();  // first clear in otherwise previuse notes will remain
				stave.setContext(ctx).draw();
				octave = $("#octaves").val();
				choosedNote = $("#notes").val();
				durationOfNote = $("#duration").val();
				console.log(octave,choosedNote,durationOfNote);
				notes[clickedNote] = new Vex.Flow.StaveNote({ keys: [choosedNote+"/"+octave], duration: durationOfNote });
				Vex.Flow.Formatter.FormatAndDraw(ctx, stave, notes);
				
				for(i=0; i < notes.length ; i++) {
					notesPos[i] = notes[i].getAbsoluteX();
				}

				if(notes.length>1) {
					gap = notesPos[1]-notesPos[0];
				}

				
				console.log(notesPos[5]-notesPos[4]);
				console.log(notesPos[1]-notesPos[0]);
				
			}

	</script>
</head>
<body>
	<div class="stave">
		<canvas width="700" height="400"></canvas>
	</div>
	<div class="notation">
		<div class="choose_note">
			<label>Choose Note :</label>
			<select id="notes">
				<option selected="selected">A</option>
				<option>B</option>
				<option>C</option>
				<option>D</option>
				<option>E</option>
				<option>F</option>
				<option>G</option>
			</select>
		</div>
		<div class="choose_octave">
			<label>Choose Octave :</label>
			<select id="octaves">
				<option selected="selected">1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
			</select>
		</div>
		<div class="choose_duration">
			<label>Choose Duration : </label>
			<select id="duration">
				<option selected="selected"  value="w">Whole</option>
				<option value="h">Half</option>
				<option value="q">Quarter</option>
				<option value="8d">Eighth</option>
				<option value="16">Sixteenth</option>
			</select>
		</div>
		<input type="button" value="Add Note" id="add_note">
		<button id="edit_note">edit</button>
	</div>
</body>
</html>