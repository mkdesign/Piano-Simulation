<!doctype html>
<html lang="en-US" direction="ltr">
<head>
	<meta charset="utf-8" />
	<title>Piano Tutorials</title>
	<link rel="stylesheet" href="reset.css">
	<link rel="stylesheet" href="style.css">
	<script src="jquery.js" ></script>
	<script src="buffer-load.js"></script>
</head>
<body>

	<!-- <div class="keys">

		<div class="key"></div>
		<div class="key black b0"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b1"></div>
		<div class="key"></div>
		<div class="key black b2"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b3"></div>
		<div class="key"></div>
		<div class="key black b4"></div>
		<div class="key"></div>
		<div class="key black b5"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b6"></div>
		<div class="key"></div>
		<div class="key black b7"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b8"></div>
		<div class="key"></div>
		<div class="key black b9"></div>
		<div class="key"></div>
		<div class="key black b10"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b11"></div>
		<div class="key"></div>
		<div class="key black b12"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b13"></div>
		<div class="key"></div>
		<div class="key black b14"></div>
		<div class="key"></div>
		<div class="key black b15"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b16"></div>
		<div class="key"></div>
		<div class="key black b17"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b18"></div>
		<div class="key"></div>
		<div class="key black b19"></div>
		<div class="key"></div>
		<div class="key black b20"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b21"></div>
		<div class="key"></div>
		<div class="key black b22"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b23"></div>
		<div class="key"></div>
		<div class="key black b24"></div>
		<div class="key"></div>
		<div class="key black b25"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b26"></div>
		<div class="key"></div>
		<div class="key black b27"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b28"></div>
		<div class="key"></div>
		<div class="key black b29"></div>
		<div class="key"></div>
		<div class="key black b30"></div>
		<div class="key"></div>

		<div class="key"></div>
		<div class="key black b31"></div>
		<div class="key"></div>
		<div class="key black b32"></div>
		<div class="key"></div>
		<div class="key"></div>
		<div class="key black b33"></div>
		<div class="key"></div>
		<div class="key black b34"></div>
		<div class="key"></div>
		<div class="key black b35"></div>
		<div class="key"></div>
		<div class="key"></div>

		<div class="clear"></div>
	</div> -->
	<div class="keys minipad">
		<div class="key"><span>Q</span></div>
		<div class="key black b0"><span>1</span></div>
		<div class="key"><span>W</span></div>

		<div class="key"><span>E</span></div>
		<div class="key black b1"><span>2</span></div>
		<div class="key"><span>R</span></div>
		<div class="key black b2"><span>3</span></div>
		<div class="key"><span>T</span></div>
		<div class="key"><span>Y</span></div>
		<div class="key black b3"><span>4</span></div>
		<div class="key"><span>U</span></div>
		<div class="key black b4"><span>5</span></div>
		<div class="key"><span>I</span></div>
		<div class="key black b5"><span>6</span></div>
		<div class="key"><span>A</span></div>

		<div class="key"><span>S</span></div>
		<div class="key black b6"><span>7</span></div>
		<div class="key"><span>D</span></div>
		<div class="key black b7"><span>8</span></div>
		<div class="key"><span>F</span></div>
		<div class="key"><span>G</span></div>
		<div class="key black b8"><span>9</span></div>
		<div class="key"><span>H</span></div>
		<div class="key black b9"><span>0</span></div>
		<div class="key"><span>J</span></div>
		<div class="key black b10"><span>-</span></div>
		<div class="key"><span>K</span></div>
		<div class="clear"></div>
	</div>
	<p class="record">Record</p>
	<p class="play_record">play recorded</p>
	<div class="control">
		<div class="play" onclick="tut.show();"></div>
	</div>
	<script>
		$(function () {
			var songNotes  = [];
			var songRhythm = [];

			songNotes[0]  = [88,2,3,4];
			songRhythm[0] = [0,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.25,0.625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.5];

			songNotes[1]  = [88,32,36,32,39,32,44,43,41,39,41,39,37,36,37,36,34,32,36,39,36,44,39,48,51,49,51,48,51,49,51,48,51,49,51,44,48,46,48,44,48,46,48,44,48,46,48,41,44,43,44,41,44,43,44,41,44,43,44,38,34,39,34,43,39,44,46,44,43,41,43,41,39,38,39,38,36,34,39,38,36,38,36,34,32,34,32,31,29,31,29,27,34,32,31,32,34,22,88,27,31,27,34,27,39,38,36,34,36,34,32,31,32,31,29,27,31,34,31,39,34,42,33,42,33,42,33,34,32,30,29,30,29,27,25,27,25,24,22,34,37,34,41,34,46,44,42,41,42,41,39,37,39,37,36,34,32,34,43,34,43,32,43,34,43,31,43,32,31,32,41,32,41,31,41,32,41,29,41,37,34,31,34,27,31,36,32,29,32,26,29,34,31,28,31,24,28,17,29,27,29,22,29,24,29,25,29,22,29,15,27,25,27,20,27,22,27,24,27,20,27,25,29,32,29,37,32,41,44,42,44,41,44,42,44,41,44,42,44,37,41,39,41,37,41,39,41,37,41,39,41,34,37,36,37,34,37,36,37,34,37,36,37,31,27,32,27,36,32,37,39,37,36,34,36,34,32,31,32,31,29,27,32,31,29,31,29,27,25,27,25,24,22,24,22,20,27,25,24,25,27,15,20];
			songRhythm[1] = [0,0.875,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.5];

			recordNotes = [];
			recordRythm = [];

			window.onload = init();

			var temp_key = 0;

			var context;
			var timeR = 0;
			var timeL = 0;
			var zarb = 60/0.25;
			var tempo = 60;

			var ratio = zarb/tempo;

			var keys = $('.keys').find('.key');
			var bufferLoader;
			var prev = -2;
			var aniDelay = 0.100;
			var notesByKeyCode = [113,49,119,101,50,114,51,116,121,52,117,53,105,54,97,115,55,100,56,102,103,57,104,48,106,45,107];
			//var keysOnKeyboard = [q,'1',w,e,'2',r,'3',t,y,'4',u,'5',i,'6',a,s,'7',d,'8',f,g,'9',h,'0',j,'-',k];
			var bufferList = bufferLoader.bufferList;
			function init() {
			    try {
			        context = new AudioContext();
			    }
			    catch(e) {
			        alert("Web Audio API is not supported in this browser");
			    }
			    
			    // Start loading the drum kit.
			    bufferLoader = new BufferLoader(
			        context,
			        [
			        
						'../piano/sound/A0.mp3',
						'../piano/sound/Bb0.mp3',
						'../piano/sound/B0.mp3',

						'../piano/sound/C1.mp3',
						'../piano/sound/Db1.mp3',
						'../piano/sound/D1.mp3',
						'../piano/sound/Eb1.mp3',
						'../piano/sound/E1.mp3',
						'../piano/sound/F1.mp3',
						'../piano/sound/Gb1.mp3',
						'../piano/sound/G1.mp3',
						'../piano/sound/Ab1.mp3',
						'../piano/sound/A1.mp3',
						'../piano/sound/Bb1.mp3',
						'../piano/sound/B1.mp3',

						'../piano/sound/C2.mp3',
						'../piano/sound/Db2.mp3',
						'../piano/sound/D2.mp3',
						'../piano/sound/Eb2.mp3',
						'../piano/sound/E2.mp3',
						'../piano/sound/F2.mp3',
						'../piano/sound/Gb2.mp3',
						'../piano/sound/G2.mp3',
						'../piano/sound/Ab2.mp3',
						'../piano/sound/A2.mp3',
						'../piano/sound/Bb2.mp3',
						'../piano/sound/B2.mp3',

						'../piano/sound/C3.mp3',
						'../piano/sound/Db3.mp3',
						'../piano/sound/D3.mp3',
						'../piano/sound/Eb3.mp3',
						'../piano/sound/E3.mp3',
						'../piano/sound/F3.mp3',
						'../piano/sound/Gb3.mp3',
						'../piano/sound/G3.mp3',
						'../piano/sound/Ab3.mp3',
						'../piano/sound/A3.mp3',
						'../piano/sound/Bb3.mp3',
						'../piano/sound/B3.mp3',

						'../piano/sound/C4.mp3',
						'../piano/sound/Db4.mp3',
						'../piano/sound/D4.mp3',
						'../piano/sound/Eb4.mp3',
						'../piano/sound/E4.mp3',
						'../piano/sound/F4.mp3',
						'../piano/sound/Gb4.mp3',
						'../piano/sound/G4.mp3',
						'../piano/sound/Ab4.mp3',
						'../piano/sound/A4.mp3',
						'../piano/sound/Bb4.mp3',
						'../piano/sound/B4.mp3',

						'../piano/sound/C5.mp3',
						'../piano/sound/Db5.mp3',
						'../piano/sound/D5.mp3',
						'../piano/sound/Eb5.mp3',
						'../piano/sound/E5.mp3',
						'../piano/sound/F5.mp3',
						'../piano/sound/Gb5.mp3',
						'../piano/sound/G5.mp3',
						'../piano/sound/Ab5.mp3',
						'../piano/sound/A5.mp3',
						'../piano/sound/Bb5.mp3',
						'../piano/sound/B5.mp3',

						'../piano/sound/C6.mp3',
						'../piano/sound/Db6.mp3',
						'../piano/sound/D6.mp3',
						'../piano/sound/Eb6.mp3',
						'../piano/sound/E6.mp3',
						'../piano/sound/F6.mp3',
						'../piano/sound/Gb6.mp3',
						'../piano/sound/G6.mp3',
						'../piano/sound/Ab6.mp3',
						'../piano/sound/A6.mp3',
						'../piano/sound/Bb6.mp3',
						'../piano/sound/B6.mp3',

						'../piano/sound/C7.mp3',
						'../piano/sound/Db7.mp3',
						'../piano/sound/D7.mp3',
						'../piano/sound/Eb7.mp3',
						'../piano/sound/E7.mp3',
						'../piano/sound/F7.mp3',
						'../piano/sound/Gb7.mp3',
						'../piano/sound/G7.mp3',
						'../piano/sound/Ab7.mp3',
						'../piano/sound/A7.mp3',
						'../piano/sound/Bb7.mp3',
						'../piano/sound/B7.mp3',

						'../piano/sound/C8.mp3',

						 '../piano/sound/silence.wav'
			        ],
			        bufferLoadCompleted  
			    );

			    bufferLoader.load();
			}

			function bufferLoadCompleted (){

				var startTime = context.currentTime + 0.100;
				var audios = bufferLoader.bufferList;
				keys.each(function(){
					$(this).click(function(){
						var keyIndex = $(this).index();
						playsong(audios[keyIndex],startTime);
					})
				});
				$(document).keypress(function(event){
					var pos = notesByKeyCode.indexOf(event.which);
					playsong(audios[pos],startTime);
					keys.eq(pos).addClass('active');
					
					setTimeout(function(){
						keys.eq(pos).removeClass('active');
					},1000);
				})
			}

			function playsong (buffer, time){
				var source = context.createBufferSource();
				source.buffer = buffer;
				var gain = context.createGain();
				gain.gain.value = 1;
				source.connect(gain);
				gain.connect(context.destination);
				source.start(context.currentTime+time,0,1);
			}

			
			var tutorial = function(array,bufferList,keys,animateTime,keyCodes){
				this.array        = array;
				this.bufferList   = bufferList;
				this.curren1      = 1;
				this.keys         = keys;
				this.animateTime  = animateTime;
				this.userAnswered = false;
				this.keyCodes     = keyCodes;
			}

			tutorial.prototype.getAnswer = function(){

				var that = this;

				$(document).on('keypress',function(event){

					var answerCode = event.which;
					console.log(answerCode);
					that.userAnswered = true;
					that.checkAnswer(answerCode);
				});

			}

			tutorial.prototype.checkAnswer = function(charCode){
				//console.log();
				$(document).off('keypress');
				if(this.userAnswered) {
					if(charCode==this.keyCodes[this.array[this.curren1]]) {
						this.keys.eq(this.array[this.curren1]).addClass('correct');
						var self = this;
						setTimeout(function(){

							self.keys.eq(self.array[self.curren1]).removeClass('correct');
							self.next_step();
						},500);
						
					}
					else {
						var pos = notesByKeyCode.indexOf(charCode);
						this.keys.eq(this.array[this.curren1]).addClass('correct');
						this.keys.eq(pos).addClass('wrong');
						var self = this;

						setTimeout(function(){

							self.keys.eq(self.array[self.curren1]).removeClass('correct');
							self.keys.eq(pos).removeClass('wrong');
							self.getAnswer();
						},500);
					}
				}
			}

			tutorial.prototype.show = function() {

				//add animation
				playsong(this.bufferList[this.array[this.curren1]],0);
				this.keys.eq(this.array[this.curren1]).addClass('active');

				//remove animation
				var self = this;
				setTimeout(function(){

					self.keys.eq(self.array[self.curren1]).removeClass('active');

				},1000);

				this.getAnswer();
			};

			tutorial.prototype.next_step = function() {
				if(this.curren1 < this.array.length){
					
					this.curren1++;
					this.show();
				}

				else {
					return ;
				}
			};

			tut = new tutorial(songNotes[0],bufferLoader.bufferList,keys,songRhythm[0],notesByKeyCode);

			$('p.record').click(function(){
				
				keys.each(function(){
					$(this).click(function(){

						var keyIndex = $(this).index();
						recordNotes.push(keyIndex);
						recordRythm.push(context.currentTime);
					});
				})
				
			})

			$('p.play_record').click(function(){
				console.log(recordRythm);
				if(recordNotes.length) {
					for(var i=0; i<recordNotes.length; i++) {
						playsong(bufferList[recordNotes[i]],recordRythm[i]);
					}
				}
			})


		})


	</script>
</body>
</html>